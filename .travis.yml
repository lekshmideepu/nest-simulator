
# .travis.yaml
#
# This file is part of NEST.
#
# Copyright (C) 2004 The NEST Initiative
#
# NEST is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 2 of the License, or
# (at your option) any later version.
#
# NEST is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with NEST.  If not, see <http://www.gnu.org/licenses/>.


# This is the Travis CI top-level script to setup and run the NEST
# build and test environment.

language: python

services:
  - docker

env:
  global:
    - NAME=nest-simulator
    - CACHE_FOLDER=$HOME/docker-images
    - CACHE_FILE=${CACHE_FOLDER}/${NAME}.tgz


jobs:
  include:
    - stage: "First"                # naming the Tests stage
      name: "With Caching"            # names the first Tests stage job
      script:
        - docker pull nestsim/nest:builder
        - mkdir -p ${CACHE_FOLDER}
        - docker save nestsim/nest:builder | gzip -c > ${CACHE_FILE}
        #- docker run -it --rm -v $(pwd):/opt/data nestsim/nest:builder build
    - stage: Second
      name: "In parallel - read from cache"
      script:
        - ls -la ${CACHE_FOLDER}
        - if [[ -f ${CACHE_FILE} ]]; then docker load -i ${CACHE_FILE}; fi
        - docker images
        - docker run -it --rm -v $(pwd):/opt/data nestsim/nest:builder build
    - stage: Second
      name: "In parallel - read from cache"
      script:
        - ls -la ${CACHE_FOLDER}
        - if [[ -f ${CACHE_FILE} ]]; then docker load -i ${CACHE_FILE}; fi
        - docker images
        - docker run -it --rm -v $(pwd):/opt/data nestsim/nest:builder build
